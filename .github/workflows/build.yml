name: ci

on: push

env:
  mold_version: "1.2.0"

jobs:

  test_deb:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      matrix:
        container_image:
          [
            "ubuntu:20.04",
            "debian:11",
          ]
    container:
      image: ${{ matrix.container_image }}
    steps:
    - name: Download from github release
      run: |
        export DEBIAN_FRONTEND=noninteractive
        apt-get update && apt-get install -y wget tar curl
        curl -fsSL https://raw.githubusercontent.com/ren15/mold_ci/HEAD/install.sh | bash
        mold --version

  test_rpm:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      matrix:
        container_image:
          [
            "fedora:35",
            "rockylinux:8",
          ]
    container:
      image: ${{ matrix.container_image }}
    steps:
    - name: Download from github release
      run: |
        yum install -y tar wget openssl-devel curl
        curl -fsSL https://raw.githubusercontent.com/ren15/mold_ci/HEAD/install.sh | bash
        mold --version

  test_centos7:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      matrix:
        container_image:
          [
            "centos:7"
          ]
    container:
      image: ${{ matrix.container_image }}
    steps:
    - name: Download from github release
      run: |
        yum install -y tar wget openssl-devel curl
        wget -c https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/o/openssl11-libs-1.1.1k-3.el7.x86_64.rpm
        rpm -i openssl11-libs-1.1.1k-3.el7.x86_64.rpm
        curl -fsSL https://raw.githubusercontent.com/ren15/mold_ci/HEAD/install.sh | bash
        mold --version